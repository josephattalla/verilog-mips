# verilog-mips
This project implements a **32-bit 5-stage pipelined MIPS processor** entirely in Verilog. It models a complete pipelined CPU with instruction fetch, decode, execute, memory access, and write-back stages, supporting basic MIPS instructions along with forwarding, stall control, and jump/branch handling.

## Supported Instructions

1. **ADD rd, rs, rt**: `Reg[rd] = Reg[rs] + Reg[rt]`
2. **SUB rd, rs, rt**: `Reg[rd] = Reg[rs] - Reg[rt]`
3. **SLT rd, rs, rt**: `Reg[rd] = 1 if Reg[rs] < Reg[rt], else 0`
4. **BNE rs, rt, imm16**: `if (Reg[rs] != Reg[rt]) PC = PC + 4 + SignExt(imm16)<<2 else PC = PC + 4`
5. **J target**: `PC = {PC[31:28], target, 00}`
6. **JR rs**: `PC = Reg[rs]`
7. **LW rt, imm16(rs)**: `Reg[rt] = Mem[Reg[rs] + SignExt(imm16)]`
8. **SW rt, imm16(rs)**: `Mem[Reg[rs] + SignExt(imm16)] = Reg[rt]`
9. **XORI rt, rs, imm16**: `Reg[rt] = Reg[rs] XOR ZeroExt(imm16)`

## Features

- **5-stage pipeline**: IF, ID, EX, MEM, WB.
- **Forwarding Unit**: Resolves data hazards to minimize stalls.
- **Stall Control**: Detects load-use hazards and stalls the pipeline as needed.
- **Control Unit**: Generates control signals for ALU, memory, and register file operations.
- **ALU and ALU Control**: Supports arithmetic, logical operations, and immediate values.
- **Memory Access**: Instruction and data memory modules.
- **Register File**: 32 general-purpose registers.
- **PC Control**: Handles jumps, branches, and `JR` instructions.
- **Testbench Included**: Clock generation, reset, and waveform output for simulation.

## File Structure

- `top.v`: Top-level module for the pipelined processor.
- `register.v`: Register file and parameterized register module for pipeline registers and general storage.
- `instrMem.v`: Instruction memory module.
- `dataMem.v`: Data memory module.
- `control.v`: Main control unit for instruction decoding.
- `ALUControl.v`: Generates ALU operation signals.
- `alu.v`: Arithmetic Logic Unit module.
- `forwarding.v`: Forwarding unit for resolving data hazards.
- `stallControl.v`: Detects hazards and generates pipeline stall signals.
- `tb/alu_tb.v`: ALU testbench.
- `tb/instrmem_tb.v`: Instruction memory testbench.
- `tb/register_tb.v`: Register file testbench.
- `test.asm`: MIPS test instructions.
- `instr.txt`: Program memory.
- `init_instrmem.py`: Initialize program memory with all 0's.

## Simulation

- Generates waveforms using `$dumpfile` and `$dumpvars`.
- Can be viewed with **GTKWave** or any Verilog simulator.
- Monitors key registers (`$zero`, `$s0–$s5`) and pipeline flush signals.

## How to Run

1. Put instruction machine code into instrmem.txt
2. Synthesize
```bash
iverilog top.v
```
3. Run the simulation and generate waveform files:
```bash
vvp ./a.out
```
4. View signals in GTKWave
```bash
gtkwave mips.vcd
```

## Output

Test program output:
```
❯ vvp ./a.out
VCD info: dumpfile mips.vcd opened for output.
PC=xxxxxxxx  IF_instr=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx id_instr=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx ifid_flush=x $zero=00000000 $s0=00000000 $s1=00000000 $s2=00000000 $s3=00000000 $s4=00000000 $s5=00000000 x
PC=00000000  IF_instr=00111000000100000000000000000011 id_instr=00000000000000000000000000000000 ifid_flush=0 $zero=00000000 $s0=00000000 $s1=00000000 $s2=00000000 $s3=00000000 $s4=00000000 $s5=00000000 0
PC=00000000  IF_instr=00111000000100000000000000000011 id_instr=00000000000000000000000000000000 ifid_flush=0 $zero=00000000 $s0=00000000 $s1=00000000 $s2=00000000 $s3=00000000 $s4=00000000 $s5=00000000 0
PC=00000004  IF_instr=00111000000100010000000000000100 id_instr=00111000000100000000000000000011 ifid_flush=0 $zero=00000000 $s0=00000000 $s1=00000000 $s2=00000000 $s3=00000000 $s4=00000000 $s5=00000000 0
PC=00000008  IF_instr=00001000000000000000000000000101 id_instr=00111000000100010000000000000100 ifid_flush=0 $zero=00000000 $s0=00000000 $s1=00000000 $s2=00000000 $s3=00000000 $s4=00000000 $s5=00000000 0
PC=0000000c  IF_instr=00111000000100000000000000000001 id_instr=00001000000000000000000000000101 ifid_flush=0 $zero=00000000 $s0=00000000 $s1=00000000 $s2=00000000 $s3=00000000 $s4=00000000 $s5=00000000 0
PC=00000014  IF_instr=00000010001100001001000000100010 id_instr=00111000000100000000000000000001 ifid_flush=1 $zero=00000000 $s0=00000000 $s1=00000000 $s2=00000000 $s3=00000000 $s4=00000000 $s5=00000000 0
PC=00000018  IF_instr=00010110000100011111111111111100 id_instr=00000010001100001001000000100010 ifid_flush=0 $zero=00000000 $s0=00000003 $s1=00000000 $s2=00000000 $s3=00000000 $s4=00000000 $s5=00000000 0
PC=0000001c  IF_instr=00000010000100011001100000100000 id_instr=00010110000100011111111111111100 ifid_flush=0 $zero=00000000 $s0=00000003 $s1=00000004 $s2=00000000 $s3=00000000 $s4=00000000 $s5=00000000 0
PC=00000020  IF_instr=10101110010100110000000000010000 id_instr=00000010000100011001100000100000 ifid_flush=0 $zero=00000000 $s0=00000003 $s1=00000004 $s2=00000000 $s3=00000000 $s4=00000000 $s5=00000000 0
PC=0000000c  IF_instr=00111000000100000000000000000001 id_instr=10101110010100110000000000010000 ifid_flush=1 $zero=00000000 $s0=00000003 $s1=00000004 $s2=00000000 $s3=00000000 $s4=00000000 $s5=00000000 0
PC=00000010  IF_instr=00111000000100010000000000000001 id_instr=00111000000100000000000000000001 ifid_flush=0 $zero=00000000 $s0=00000003 $s1=00000004 $s2=00000001 $s3=00000000 $s4=00000000 $s5=00000000 0
PC=00000014  IF_instr=00000010001100001001000000100010 id_instr=00111000000100010000000000000001 ifid_flush=0 $zero=00000000 $s0=00000003 $s1=00000004 $s2=00000001 $s3=00000000 $s4=00000000 $s5=00000000 0
PC=00000018  IF_instr=00010110000100011111111111111100 id_instr=00000010001100001001000000100010 ifid_flush=0 $zero=00000000 $s0=00000003 $s1=00000004 $s2=00000001 $s3=00000000 $s4=00000000 $s5=00000000 0
PC=0000001c  IF_instr=00000010000100011001100000100000 id_instr=00010110000100011111111111111100 ifid_flush=0 $zero=00000000 $s0=00000003 $s1=00000004 $s2=00000001 $s3=00000000 $s4=00000000 $s5=00000000 0
PC=00000020  IF_instr=10101110010100110000000000010000 id_instr=00000010000100011001100000100000 ifid_flush=0 $zero=00000000 $s0=00000001 $s1=00000004 $s2=00000001 $s3=00000000 $s4=00000000 $s5=00000000 0
PC=00000024  IF_instr=10001110010101000000000000010000 id_instr=10101110010100110000000000010000 ifid_flush=0 $zero=00000000 $s0=00000001 $s1=00000001 $s2=00000001 $s3=00000000 $s4=00000000 $s5=00000000 0
PC=00000028  IF_instr=00000010000101001010100000101010 id_instr=10001110010101000000000000010000 ifid_flush=0 $zero=00000000 $s0=00000001 $s1=00000001 $s2=00000000 $s3=00000000 $s4=00000000 $s5=00000000 0
PC=0000002c  IF_instr=10001110010100110000000000010000 id_instr=00000010000101001010100000101010 ifid_flush=0 $zero=00000000 $s0=00000001 $s1=00000001 $s2=00000000 $s3=00000000 $s4=00000000 $s5=00000000 1
PC=0000002c  IF_instr=10001110010100110000000000010000 id_instr=00000010000101001010100000101010 ifid_flush=0 $zero=00000000 $s0=00000001 $s1=00000001 $s2=00000000 $s3=00000002 $s4=00000000 $s5=00000000 0
PC=00000030  IF_instr=00111010010100110000000000000001 id_instr=10001110010100110000000000010000 ifid_flush=0 $zero=00000000 $s0=00000001 $s1=00000001 $s2=00000000 $s3=00000002 $s4=00000000 $s5=00000000 0
PC=00000034  IF_instr=00111010101101010000000000000001 id_instr=00111010010100110000000000000001 ifid_flush=0 $zero=00000000 $s0=00000001 $s1=00000001 $s2=00000000 $s3=00000002 $s4=00000002 $s5=00000000 1
PC=00000034  IF_instr=00111010101101010000000000000001 id_instr=00111010010100110000000000000001 ifid_flush=0 $zero=00000000 $s0=00000001 $s1=00000001 $s2=00000000 $s3=00000002 $s4=00000002 $s5=00000000 0
PC=00000038  IF_instr=00000010101000000000000000001000 id_instr=00111010101101010000000000000001 ifid_flush=0 $zero=00000000 $s0=00000001 $s1=00000001 $s2=00000000 $s3=00000002 $s4=00000002 $s5=00000001 0
PC=0000003c  IF_instr=00000000000000000000000000000000 id_instr=00000010101000000000000000001000 ifid_flush=0 $zero=00000000 $s0=00000001 $s1=00000001 $s2=00000000 $s3=00000002 $s4=00000002 $s5=00000001 0
PC=00000040  IF_instr=00000000000000000000000000000000 id_instr=00000000000000000000000000000000 ifid_flush=0 $zero=00000000 $s0=00000001 $s1=00000001 $s2=00000000 $s3=00000002 $s4=00000002 $s5=00000001 0
PC=00000000  IF_instr=00111000000100000000000000000011 id_instr=00000000000000000000000000000000 ifid_flush=1 $zero=00000000 $s0=00000001 $s1=00000001 $s2=00000000 $s3=00000001 $s4=00000002 $s5=00000001 0
PC=00000004  IF_instr=00111000000100010000000000000100 id_instr=00111000000100000000000000000011 ifid_flush=0 $zero=00000000 $s0=00000001 $s1=00000001 $s2=00000000 $s3=00000001 $s4=00000002 $s5=00000000 0
PC=00000008  IF_instr=00001000000000000000000000000101 id_instr=00111000000100010000000000000100 ifid_flush=0 $zero=00000000 $s0=00000001 $s1=00000001 $s2=00000000 $s3=00000001 $s4=00000002 $s5=00000000 0
PC=0000000c  IF_instr=00111000000100000000000000000001 id_instr=00001000000000000000000000000101 ifid_flush=0 $zero=00000000 $s0=00000001 $s1=00000001 $s2=00000000 $s3=00000001 $s4=00000002 $s5=00000000 0
PC=00000014  IF_instr=00000010001100001001000000100010 id_instr=00111000000100000000000000000001 ifid_flush=1 $zero=00000000 $s0=00000001 $s1=00000001 $s2=00000000 $s3=00000001 $s4=00000002 $s5=00000000 0
PC=00000018  IF_instr=00010110000100011111111111111100 id_instr=00000010001100001001000000100010 ifid_flush=0 $zero=00000000 $s0=00000003 $s1=00000001 $s2=00000000 $s3=00000001 $s4=00000002 $s5=00000000 0
PC=0000001c  IF_instr=00000010000100011001100000100000 id_instr=00010110000100011111111111111100 ifid_flush=0 $zero=00000000 $s0=00000003 $s1=00000004 $s2=00000000 $s3=00000001 $s4=00000002 $s5=00000000 0
top.v:546: $finish called at 1600000 (100fs)
```
